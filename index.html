<!-- ... existing code ... -->
<script>
/**
 * AUDIO FIX: Synthetic Audio System
 * Replaces external file loading with Web Audio API synthesis
 * to prevent "Audio Load Error" and CORS issues.
 */
class SynthesizedAudio {
    constructor(src) {
        this.src = src || '';
        this.volume = 1.0;
        this.loop = false;
        // Create context lazily to avoid auto-play restrictions until interaction
        this._ctx = new (window.AudioContext || window.webkitAudioContext)();
    }

    play() {
        if (this._ctx.state === 'suspended') this._ctx.resume();
        
        const isMusic = this.src.toLowerCase().includes('music') || 
                       this.src.toLowerCase().includes('bgm') ||
                       this.loop;
        
        if (isMusic) {
            this._playMusic();
        } else {
            this._playSfx();
        }
        return Promise.resolve();
    }

    pause() {
        if (this._musicOsc) {
            this._musicOsc.stop();
            this._musicOsc = null;
        }
    }

    set currentTime(t) {} // No-op for synth

    _playSfx() {
        const osc = this._ctx.createOscillator();
        const gain = this._ctx.createGain();
        osc.connect(gain);
        gain.connect(this._ctx.destination);

        const src = this.src.toLowerCase();
        
        // Customize sounds based on keywords in the original file path
        if (src.includes('clear') || src.includes('win') || src.includes('success')) {
            // Success: High major chord
            this._tone(osc, gain, 523.25, 'triangle', 0.1); // C5
            setTimeout(() => {
                const o2 = this._ctx.createOscillator();
                const g2 = this._ctx.createGain();
                o2.connect(g2); g2.connect(this._ctx.destination);
                this._tone(o2, g2, 659.25, 'triangle', 0.2); // E5
            }, 100);
        } else if (src.includes('over') || src.includes('fail') || src.includes('die')) {
            // Failure: Low descending buzz
            this._tone(osc, gain, 150, 'sawtooth', 0.4);
            osc.frequency.exponentialRampToValueAtTime(40, this._ctx.currentTime + 0.4);
        } else if (src.includes('rotate') || src.includes('move')) {
            // Movement: Short click
            this._tone(osc, gain, 400, 'square', 0.05);
        } else {
            // Default: Generic blip
            this._tone(osc, gain, 440, 'sine', 0.1);
        }
    }

    _tone(osc, gain, freq, type, dur) {
        osc.frequency.value = freq;
        osc.type = type;
        gain.gain.setValueAtTime(0.1 * this.volume, this._ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, this._ctx.currentTime + dur);
        osc.start();
        osc.stop(this._ctx.currentTime + dur);
    }

    _playMusic() {
        if (this._musicOsc) return; // Already playing
        
        this._musicOsc = this._ctx.createOscillator();
        this._musicGain = this._ctx.createGain();
        this._musicOsc.connect(this._musicGain);
        this._musicGain.connect(this._ctx.destination);
        
        // Gentle ambient drone (Low A)
        this._musicOsc.frequency.value = 110; 
        this._musicOsc.type = 'triangle';
        this._musicGain.gain.value = 0.05 * this.volume;
        this._musicOsc.start();
    }
}

// Override the native Audio constructor globally
// This ensures that any existing "new Audio()" calls use our synthesizer instead
window.Audio = SynthesizedAudio;

// ... existing code ...
