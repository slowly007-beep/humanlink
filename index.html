<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Music Turing Test</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. 폰트 (Pretendard) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <style>
        body { font-family: "Pretendard", -apple-system, sans-serif; background-color: #000; color: #fff; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #121212; }
        ::-webkit-scrollbar-thumb { background: #5a5a5a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #888; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .animate-spin-slow { animation: spin 8s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-black text-white selection:bg-[#1DB954] selection:text-black">
    
    <div id="root">
        <div class="min-h-screen flex flex-col items-center justify-center space-y-4">
            <div class="w-12 h-12 border-4 border-[#1DB954] border-t-transparent rounded-full animate-spin"></div>
            <p class="text-gray-400 font-medium animate-pulse">앱을 불러오는 중입니다...</p>
        </div>
    </div>

    <script type="text/babel" data-presets="react">
        const { useState, useRef, useEffect } = React;

        // --- 아이콘 컴포넌트 ---
        const Icon = ({ children, className, size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Play = (props) => <Icon {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></Icon>;
        const Pause = (props) => <Icon {...props}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></Icon>;
        const XCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></Icon>;
        const Copy = (props) => <Icon {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></Icon>;
        const ExternalLink = (props) => <Icon {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></Icon>;
        const QrCode = (props) => <Icon {...props}><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16v.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v-1"/></Icon>;
        const Disc = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle></Icon>;

        const App = () => {
            // https://m.kpedia.jp/w/13159 캐시 문제 방지를 위해 랜덤 파라미터 추가
            const GAME_CONFIG = {
                trackAUrl: 'https://raw.githubusercontent.com/slowly007-beep/humanlink/main/Music_A.mp3?t=' + new Date().getTime(),
                trackBUrl: 'https://raw.githubusercontent.com/slowly007-beep/humanlink/main/Music_B.mp3?t=' + new Date().getTime(),
                correctAnswer: 'A',
                promptText: "A futuristic city pop track with heavy synth bass, upbeat tempo, and female vocals dreaming of electric sheep."
            };

            const [gameState, setGameState] = useState('listening');
            const [playedTracks, setPlayedTracks] = useState({ A: false, B: false });
            const [isPlaying, setIsPlaying] = useState(null);
            const [isCorrect, setIsCorrect] = useState(false);
            const [copied, setCopied] = useState(false);

            // Ref for HTML Audio Elements
            const audioARef = useRef(null);
            const audioBRef = useRef(null);

            const togglePlay = async (track) => {
                const targetAudio = track === 'A' ? audioARef.current : audioBRef.current;
                const otherAudio = track === 'A' ? audioBRef.current : audioARef.current;

                if (!targetAudio || !otherAudio) {
                    alert("오디오를 불러오는 중입니다. 잠시만 기다려주세요.");
                    return;
                }

                try {
                    // 다른 트랙 정지
                    if (isPlaying && isPlaying !== track) {
                        otherAudio.pause();
                        otherAudio.currentTime = 0;
                    }

                    if (isPlaying === track) {
                        targetAudio.pause();
                        setIsPlaying(null);
                    } else {
                        // 재생 시도
                        await targetAudio.play();
                        setIsPlaying(track);
                        setPlayedTracks(prev => ({ ...prev, [track]: true }));
                    }
                } catch (error) {
                    console.error("Playback Error:", error);
                    const fileName = track === 'A' ? "Music_A.mp3" : "Music_B.mp3";
                    alert(`재생 실패: ${error.message}\n\n[확인사항]\n1. GitHub 저장소가 Public(공개) 상태인지 확인해주세요.\n2. 파일 주소: ${targetAudio.src}`);
                    setIsPlaying(null);
                }
            };

            const handleAudioEnded = () => {
                setIsPlaying(null);
            };

            const handleAudioError = (e, track) => {
                console.error(`Audio Load Error (${track}):`, e);
                // 로딩 시점에 에러가 나면 콘솔에만 찍고, 사용자가 재생 버튼 누를 때 알림
            };

            const handleGuess = (choice) => {
                if (audioARef.current) audioARef.current.pause();
                if (audioBRef.current) audioBRef.current.pause();
                setIsPlaying(null);
                
                const isAnswerCorrect = choice === GAME_CONFIG.correctAnswer;
                setIsCorrect(isAnswerCorrect);
                setGameState('result');
            };

            const handleContinue = () => setGameState('outro');

            const handleCopyPrompt = () => {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(GAME_CONFIG.promptText).then(() => {
                        setCopied(true);
                        setTimeout(() => setCopied(false), 2000);
                    });
                } else {
                    alert("프롬프트가 클립보드에 복사되지 않았습니다.");
                }
            };

            const handleReset = () => {
                if (audioARef.current) {
                    audioARef.current.pause();
                    audioARef.current.currentTime = 0;
                }
                if (audioBRef.current) {
                    audioBRef.current.pause();
                    audioBRef.current.currentTime = 0;
                }
                setPlayedTracks({ A: false, B: false });
                setGameState('listening');
                setIsPlaying(null);
                setIsCorrect(false);
            };

            const allPlayed = playedTracks.A && playedTracks.B;
            const canVote = allPlayed && isPlaying === null;

            return (
                <div className="min-h-screen bg-black text-white flex items-center justify-center p-4 lg:p-8 tracking-tight font-sans">
                    {/* --- [핵심] HTML Audio 태그 직접 삽입 (보안 이슈 회피) --- */}
                    {/* crossOrigin 속성을 제거하여 'opaque' 모드로 재생 (가장 관대한 설정) */}
                    <audio 
                        ref={audioARef} 
                        src={GAME_CONFIG.trackAUrl} 
                        preload="auto"
                        onEnded={handleAudioEnded}
                        onError={(e) => handleAudioError(e, 'A')}
                    />
                    <audio 
                        ref={audioBRef} 
                        src={GAME_CONFIG.trackBUrl} 
                        preload="auto" 
                        onEnded={handleAudioEnded}
                        onError={(e) => handleAudioError(e, 'B')}
                    />

                    <div className="w-full max-w-7xl bg-[#121212] rounded-[32px] overflow-hidden shadow-2xl flex flex-col lg:flex-row min-h-[85vh] ring-1 ring-[#333]">
                        
                        {/* 왼쪽 패널 */}
                        <div className="flex-1 lg:flex-[2.2] p-8 lg:p-16 flex flex-col relative bg-gradient-to-b from-[#2a2a2a] to-[#121212]">
                            <header className="flex items-center justify-between mb-12">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-white text-black rounded-full flex items-center justify-center">
                                        <Disc size={24} className="animate-spin-slow" />
                                    </div>
                                    <h1 className="text-xl font-bold tracking-tighter">AI Music Test</h1>
                                </div>
                            </header>

                            <div className="flex-1 flex flex-col justify-center items-center w-full">
                                {(gameState === 'listening' || gameState === 'guessing') && (
                                    <div className="w-full max-w-4xl space-y-12 animate-fade-in">
                                        <div className="space-y-3">
                                            <h2 className="text-4xl lg:text-6xl font-black leading-tight tracking-tighter">
                                                {canVote ? "Real vs AI" : "Listen & Compare"}
                                            </h2>
                                            <p className="text-[#b3b3b3] text-lg lg:text-xl font-medium">
                                                {canVote ? "어떤 트랙이 AI가 만든 음악일까요?" : "두 트랙을 감상하고 AI가 만든 곡을 찾아보세요."}
                                            </p>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            {['A', 'B'].map((track) => (
                                                <div key={track} className={`
                                                    group relative bg-[#181818] hover:bg-[#282828] rounded-xl p-6 transition-all duration-300 cursor-pointer
                                                    ${isPlaying === track ? 'bg-[#282828]' : ''}
                                                `}>
                                                    <div className="relative aspect-square mb-6 bg-[#333] rounded shadow-lg overflow-hidden group-hover:shadow-2xl transition-shadow">
                                                        <div className={`absolute inset-0 bg-gradient-to-br flex items-center justify-center ${track === 'A' ? 'from-indigo-500 to-purple-600' : 'from-pink-500 to-rose-600'}`}>
